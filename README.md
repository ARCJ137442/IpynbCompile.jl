<!-- âš ï¸è¯¥æ–‡ä»¶ç”± `IpynbCompile.ipynb` è‡ªåŠ¨ç”Ÿæˆäº 2024-09-14T21:33:32.587ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ -->
# IpynbCompile.jl: ä¸€ä¸ªå®ç”¨çš„Jupyterç¬”è®°æœ¬æ„å»ºå·¥å…·

![GitHub License](https://img.shields.io/github/license/ARCJ137442/IpynbCompile.jl?style=for-the-badge&color=a270ba)
![Code Size](https://img.shields.io/github/languages/code-size/ARCJ137442/IpynbCompile.jl?style=for-the-badge&color=a270ba)
![Lines of Code](https://www.aschey.tech/tokei/github.com/ARCJ137442/IpynbCompile.jl?style=for-the-badge&color=a270ba)
[![Language](https://img.shields.io/badge/language-Julia%201.7+-purple?style=for-the-badge&color=a270ba)](https://cn.julialang.org/)

å¼€å‘çŠ¶æ€ï¼š

[![CI status](https://img.shields.io/github/actions/workflow/status/ARCJ137442/IpynbCompile.jl/ci.yml?style=for-the-badge)](https://github.com/ARCJ137442/IpynbCompile.jl/actions/workflows/ci.yml)

![Created At](https://img.shields.io/github/created-at/ARCJ137442/IpynbCompile.jl?style=for-the-badge)
![Last Commit](https://img.shields.io/github/last-commit/ARCJ137442/IpynbCompile.jl?style=for-the-badge)

[![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-%23FE5196?style=for-the-badge)](https://conventionalcommits.org)
![GitHub commits since latest release](https://img.shields.io/github/commits-since/ARCJ137442/IpynbCompile.jl/latest?style=for-the-badge)

## ä¸»è¦åŠŸèƒ½

### ç®€ä»‹

ğŸ“ä¸»è¦åŠŸèƒ½ï¼šä¸º [***Jupyter***](https://jupyter.org/) ç¬”è®°æœ¬ï¼ˆ`.ipynb`æ–‡ä»¶ï¼‰æä¾›ä¸€å¥—ç‰¹å®šçš„æ³¨é‡Šè¯­æ³•ï¼Œä»¥æ”¯æŒ **ç¼–è¯‘è½¬æ¢**&**è§£é‡Šæ‰§è¡Œ** åŠŸèƒ½ï¼Œæ‰©å±•å…¶åº”ç”¨çš„å¯èƒ½æ€§

- ğŸ“Œå¯ã€æ‰“å¼€ã€‘å¹¶ã€è§£æã€‘Jupyterç¬”è®°æœ¬ï¼šæä¾›åŸºæœ¬çš„ã€ŒJupyterç¬”è®°æœ¬ã€ã€ŒJupyterç¬”è®°æœ¬å…ƒæ•°æ®ã€ã€ŒJupyterç¬”è®°æœ¬å•å…ƒæ ¼ã€æ•°æ®ç»“æ„å®šä¹‰
  - ç¬”è®°æœ¬ `IpynbNotebook{å•å…ƒæ ¼ç±»å‹}`
  - å…ƒæ•°æ® `IpynbNotebookMetadata`
  - å•å…ƒæ ¼ `IpynbCell`
- ğŸ“Œå¯å°†Jupyterç¬”è®°æœ¬ï¼ˆ`.ipynb`æ–‡ä»¶ï¼‰ã€è½¬æ¢ã€‘æˆå¯ç›´æ¥æ‰§è¡Œçš„ [***Julia***](https://julialang.org/) ä»£ç 
  - ç¼–è¯‘å•å…ƒæ ¼ `compile_cell`
  - ç¼–è¯‘ç¬”è®°æœ¬ `compile_notebook`
    - æ–¹æ³•1ï¼š`compile_notebook(ç¬”è®°æœ¬::IpynbNotebook)`
      - åŠŸèƒ½ï¼šå°†ã€ŒJupyterç¬”è®°æœ¬ç»“æ„ã€ç¼–è¯‘æˆJuliaæºç ï¼ˆå­—ç¬¦ä¸²ï¼‰
      - è¿”å›ï¼š`String`ï¼ˆæºç å­—ç¬¦ä¸²ï¼‰
    - æ–¹æ³•2ï¼š`compile_notebook(è¾“å…¥è·¯å¾„::String, è¾“å‡ºè·¯å¾„::String="$è¾“å…¥è·¯å¾„.jl")`
      - åŠŸèƒ½ï¼šä»**æŒ‡å®šè·¯å¾„**è¯»å–å¹¶ç¼–è¯‘Jupyterç¬”è®°æœ¬
      - è¿”å›ï¼šå†™å…¥è¾“å‡ºè·¯å¾„çš„å­—èŠ‚æ•°
- ğŸ“Œæä¾›ã€è§£æå¹¶ç›´æ¥è¿è¡ŒJupyterç¬”è®°æœ¬ã€‘çš„æ–¹å¼ï¼ˆè§†ä½œJuliaä»£ç æ‰§è¡Œï¼‰
  - è§£æå•å…ƒæ ¼ `parse_cell`
    - æ–¹æ³• `parse_cell(å•å…ƒæ ¼::IpynbCell)`
      - åŠŸèƒ½ï¼šå°†ã€å•ä¸ªã€‘å•å…ƒæ ¼å†…å®¹ç¼–è¯‘è§£ææˆJuliaè¡¨è¾¾å¼ï¼ˆ`Expr`å¯¹è±¡ï¼‰
    - æ–¹æ³• `parse_cell(å•å…ƒæ ¼åˆ—è¡¨::Vector{IpynbCell})`
      - åŠŸèƒ½ï¼šå°†ã€å¤šä¸ªã€‘å•å…ƒæ ¼å†…å®¹åˆ†åˆ«ç¼–è¯‘åã€åˆå¹¶ã€‘ï¼Œç„¶åè§£ææˆJuliaè¡¨è¾¾å¼ï¼ˆ`Expr`å¯¹è±¡ï¼‰
    - è¿”å›
      - Juliaè¡¨è¾¾å¼ï¼ˆè‹¥ä¸º`code`ä»£ç ç±»å‹ï¼‰
      - `nothing`ï¼ˆè‹¥ä¸ºå…¶å®ƒç±»å‹ï¼‰
  - è§£æç¬”è®°æœ¬ `parse_notebook`
    - ç­‰æ•ˆäºã€Œç¼–è¯‘ç¬”è®°æœ¬çš„**æ‰€æœ‰å•å…ƒæ ¼**ã€
  - æ‰§è¡Œå•å…ƒæ ¼ `eval_cell`
    - ç­‰æ•ˆäºã€Œã€è§£æã€‘å¹¶ã€æ‰§è¡Œã€‘å•å…ƒæ ¼ã€
  - æ‰§è¡Œç¬”è®°æœ¬ `eval_notebook`
    - ç­‰æ•ˆäºã€Œã€è§£æã€‘å¹¶ã€æ‰§è¡Œã€‘ç¬”è®°æœ¬ã€
    - é€å•å…ƒæ ¼ç‰ˆæœ¬ï¼š`eval_notebook_by_cell`
  - å¼•å…¥ç¬”è®°æœ¬ `include_notebook`
    - é€å•å…ƒæ ¼ç‰ˆæœ¬ï¼š`include_notebook_by_cell`

âœ¨åˆ›æ–°ç‚¹ï¼š**ä½¿ç”¨å¤šæ ·çš„ã€Œç‰¹æ®Šæ³¨é‡Šã€æœºåˆ¶ï¼Œè®©ä½¿ç”¨è€…èƒ½æ›´çµæ´»ã€æ›´ä¾¿æ·åœ°ç¼–è¯‘Jupyterç¬”è®°æœ¬ï¼Œå¹¶èƒ½å°†å…¶ã€äº¤äº’å¼ã€‘ä¼˜åŠ¿ç”¨äºåº“çš„ç¼–å†™ä¹‹ä¸­**

### é‡è¦æœºåˆ¶ï¼šå•å…ƒæ ¼ã€Œç‰¹æ®Šæ³¨é‡Šã€

ç®€ä»‹ï¼šå•å…ƒæ ¼çš„ä¸»è¦ã€Œç‰¹æ®Šæ³¨é‡Šã€åŠå…¶ä½œç”¨ï¼ˆä»¥`# å•è¡Œæ³¨é‡Š` `#= å—æ³¨é‡Š =#`ä¸ºä¾‹ï¼‰

- `# %ignore-line` å¿½ç•¥ä¸‹ä¸€è¡Œ
- `# %ignore-below` å¿½ç•¥ä¸‹é¢æ‰€æœ‰è¡Œ
- `# %ignore-cell` å¿½ç•¥æ•´ä¸ªå•å…ƒæ ¼
- `# %ignore-begin` å—å¿½ç•¥å¼€å§‹
- `# %ignore-end` å—å¿½ç•¥ç»“æŸ
- `#= %only-compiled` ä»…ç¼–è¯‘åå¯ç”¨ï¼ˆå¤´ï¼‰
- `%only-compiled =#` ä»…ç¼–è¯‘åå¯ç”¨ï¼ˆå°¾ï¼‰
- `# %include <è·¯å¾„>` å¼•å…¥æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶å†…å®¹ï¼Œæ›¿ä»£ä¸€æ•´è¡Œæ³¨é‡Š

âœ¨**è¯¥ç¬”è®°æœ¬è‡ªèº«**ï¼Œå°±æ˜¯ä¸€ä¸ªå¥½çš„ç”¨æ³•å‚è€ƒæ¥æº

#### å„ä¸ªã€Œç‰¹æ®Šæ³¨é‡Šã€çš„ç”¨æ³•

##### å¿½ç•¥å•è¡Œ

ğŸ“Œç®€è¦ç”¨é€”ï¼šå¿½ç•¥**ä¸‹ä¸€è¡Œ**ä»£ç 

ç¼–è¯‘å‰@ç¬”è®°æœ¬å•å…ƒæ ¼ï¼š

```julia
[["ä¸Šè¾¹è¿˜ä¼šè¢«ç¼–è¯‘"]]
# %ignore-line # å¿½ç•¥å•è¡Œï¼ˆå¯ç›´æ¥åœ¨æ­¤æ³¨é‡Šåå¦åŠ å­—ç¬¦ï¼Œä¼šè¢«ä¸€å¹¶å¿½ç•¥ï¼‰
["è¿™æ˜¯ä¸€è¡Œè¢«å¿½ç•¥çš„ä»£ç "]
[["ä¸‹è¾¹ä¹Ÿè¦è¢«ç¼–è¯‘"]]
```

ç¼–è¯‘åï¼š

```julia
[["ä¸Šè¾¹è¿˜ä¼šè¢«ç¼–è¯‘"]]
[["ä¸‹è¾¹ä¹Ÿè¦è¢«ç¼–è¯‘"]]
```

##### å¿½ç•¥ä¸‹é¢æ‰€æœ‰è¡Œ

ç¼–è¯‘å‰@ç¬”è®°æœ¬å•å…ƒæ ¼

```julia
[["ä¸Šè¾¹çš„ä»£ç æ­£å¸¸ç¼–è¯‘"]]
# %ignore-below # å¿½ç•¥ä¸‹é¢æ‰€æœ‰è¡Œï¼ˆå¯ç›´æ¥åœ¨æ­¤æ³¨é‡Šåå¦åŠ å­—ç¬¦ï¼Œä¼šè¢«ä¸€å¹¶å¿½ç•¥ï¼‰
["""
  ä¹‹åä¼šå¿½ç•¥å¾ˆå¤šä»£ç 
"""]
["åŒ…æ‹¬è¿™ä¸€è¡Œ"]
["ä¸ç®¡å¤šé•¿éƒ½ä¼šè¢«å¿½ç•¥"]
```

ç¼–è¯‘åï¼š

```julia
[["ä¸Šè¾¹çš„ä»£ç æ­£å¸¸ç¼–è¯‘"]]
```

##### å¿½ç•¥æ•´ä¸ªå•å…ƒæ ¼

ç¼–è¯‘å‰@ç¬”è®°æœ¬å•å…ƒæ ¼ï¼š

```julia
["ä¸Šè¾¹çš„ä»£ç ä¼šè¢«å¿½ç•¥ï¼ˆä¸ä¼šè¢«ç¼–è¯‘ï¼‰"]
# %ignore-cell # å¿½ç•¥æ•´ä¸ªå•å…ƒæ ¼ï¼ˆå¯ç›´æ¥åœ¨æ­¤æ³¨é‡Šåå¦åŠ å­—ç¬¦ï¼Œä¼šè¢«ä¸€å¹¶å¿½ç•¥ï¼‰
["ä¸‹é¢çš„ä»£ç ä¹Ÿä¼šè¢«å¿½ç•¥"]
["âš ï¸å¦å¤–ï¼Œè¿™äº›ä»£ç è¿ç€å•å…ƒæ ¼éƒ½ä¸ä¼šå‡ºç°åœ¨ç¼–è¯‘åçš„æ–‡ä»¶ä¸­ï¼Œè¿ã€Œæ ‡è¯†å¤´ã€éƒ½æ²¡æœ‰"]
```

ç¼–è¯‘åï¼š

```julia
```

â†‘ç©ºå­—ä¸²

ğŸ“Œä¸€èˆ¬ä¹ æƒ¯å°† `# %ignore-cell` æ”¾åœ¨ç¬¬ä¸€è¡Œ

##### å¿½ç•¥ä»£ç å—

ğŸ“å³ã€Œå—å¿½ç•¥ã€

ç¼–è¯‘å‰@ç¬”è®°æœ¬å•å…ƒæ ¼ï¼š

```julia
[["ä¸Šè¾¹çš„ä»£ç æ­£å¸¸ç¼–è¯‘"]]
# %ignore-begin # å¼€å§‹å—å¿½ç•¥ï¼ˆå¯ç›´æ¥åœ¨æ­¤æ³¨é‡Šåå¦åŠ å­—ç¬¦ï¼Œä¼šè¢«ä¸€å¹¶å¿½ç•¥ï¼‰
["è¿™ä¸€ç³»åˆ—ä¸­é—´çš„ä»£ç ä¼šè¢«å¿½ç•¥"]
["ä¸ç®¡æœ‰å¤šå°‘è¡Œï¼Œé™¤éé‡åˆ°ç»ˆæ­¢æ³¨é‡Š"]
# %ignore-end # ç»“æŸå—å¿½ç•¥ï¼ˆå¯ç›´æ¥åœ¨æ­¤æ³¨é‡Šåå¦åŠ å­—ç¬¦ï¼Œä¼šè¢«ä¸€å¹¶å¿½ç•¥ï¼‰
[["ä¸‹é¢çš„ä»£ç éƒ½ä¼šè¢«ç¼–è¯‘"]]
```

ç¼–è¯‘åï¼š

```julia
[["ä¸Šè¾¹çš„ä»£ç æ­£å¸¸ç¼–è¯‘"]]
[["ä¸‹é¢çš„ä»£ç éƒ½ä¼šè¢«ç¼–è¯‘"]]
```

##### ä»…ç¼–è¯‘åå¯ç”¨

ä¸»è¦ç”¨é€”ï¼šåŒ…è£… `module` ç­‰ä»£ç ï¼Œå®ç°ç¼–è¯‘åæ¨¡å—ä¸Šä¸‹æ–‡

- âš ï¸å¯¹äº **Python** ç­‰ã€ä¾èµ–ç¼©è¿›å®šä¹‰ä¸Šä¸‹æ–‡ã€‘çš„è¯­è¨€ï¼Œéš¾ä»¥è¿›è¡Œæ­¤ç±»ç¼–è¯‘

ç¼–è¯‘å‰@ç¬”è®°æœ¬å•å…ƒæ ¼ï¼š

```julia
[["ä¸Šè¾¹çš„ä»£ç æ­£å¸¸ç¼–è¯‘ï¼Œå¹¶ä¸”ä¼šéšç€ç¬”è®°æœ¬ä¸€èµ·æ‰§è¡Œ"]]
#= %only-compiled # å¼€å§‹ã€Œä»…ç¼–è¯‘åå¯ç”¨ã€ï¼ˆå¯ç›´æ¥åœ¨æ­¤æ³¨é‡Šåå¦åŠ å­—ç¬¦ï¼Œä¼šè¢«ä¸€å¹¶å¿½ç•¥ï¼‰
["""
  è¿™ä¸€ç³»åˆ—ä¸­é—´çš„ä»£ç 
  - åœ¨ã€Œæ‰§è¡Œç¬”è®°æœ¬ã€æ—¶è¢«å¿½ç•¥ï¼ˆå› ä¸ºåœ¨Juliaå—æ³¨é‡Šä¹‹ä¸­ï¼‰
  - ä½†åœ¨ç¼–è¯‘åã€Œä¸Šä¸‹æ³¨é‡Šã€è¢«ç§»é™¤
    - å› æ­¤ä¼šåœ¨ç¼–è¯‘åè¢«æ‰§è¡Œ
"""]
%only-compiled =# # ç»“æŸã€Œä»…ç¼–è¯‘åå¯ç”¨ã€ï¼ˆå¯ç›´æ¥åœ¨æ­¤æ³¨é‡Šåå¦åŠ å­—ç¬¦ï¼Œä¼šè¢«ä¸€å¹¶å¿½ç•¥ï¼‰
[["ä¸‹é¢çš„ä»£ç æ­£å¸¸ç¼–è¯‘ï¼Œå¹¶ä¸”ä¼šéšç€ç¬”è®°æœ¬ä¸€èµ·æ‰§è¡Œ"]]
```

ç¼–è¯‘åï¼š

```julia
[["ä¸Šè¾¹çš„ä»£ç æ­£å¸¸ç¼–è¯‘ï¼Œå¹¶ä¸”ä¼šéšç€ç¬”è®°æœ¬ä¸€èµ·æ‰§è¡Œ"]]
["""
  è¿™ä¸€ç³»åˆ—ä¸­é—´çš„ä»£ç 
  - åœ¨ã€Œæ‰§è¡Œç¬”è®°æœ¬ã€æ—¶è¢«å¿½ç•¥ï¼ˆå› ä¸ºåœ¨Juliaå—æ³¨é‡Šä¹‹ä¸­ï¼‰
  - ä½†åœ¨ç¼–è¯‘åã€Œä¸Šä¸‹æ³¨é‡Šã€è¢«ç§»é™¤
    - å› æ­¤ä¼šåœ¨ç¼–è¯‘åè¢«æ‰§è¡Œ
"""]
[["ä¸‹é¢çš„ä»£ç æ­£å¸¸ç¼–è¯‘ï¼Œå¹¶ä¸”ä¼šéšç€ç¬”è®°æœ¬ä¸€èµ·æ‰§è¡Œ"]]
```

##### æ–‡ä»¶å¼•å…¥

ä¸»è¦ç”¨é€”ï¼šç»“åˆã€Œä»…ç¼–è¯‘åå¯ç”¨ã€ç®€å•å®ç°ã€Œå¤–éƒ¨ä»£ç å†…è”ã€

- å¦‚ï¼šé›†æˆæŸäº›**ä¸­å°å‹æ˜ å°„è¡¨**ï¼Œæ•´åˆé›¶æ•£æºç æ–‡ä»¶â€¦â€¦

ç¼–è¯‘å‰@ç¬”è®°æœ¬å•å…ƒæ ¼ï¼š

```julia
const square_map_dict = # è¿™é‡Œçš„ç­‰å·å¯ä»¥å¦èµ·ä¸€è¡Œ
# %include to_include.jl 
# â†‘ ä¸Šé¢ä¸€è¡Œä¼šè¢«æ›¿æ¢æˆæ–‡ä»¶å†…å®¹
```

ç¼–è¯‘å‰@å’Œç¬”è®°æœ¬**åŒç›®å½•**ä¸‹çš„`to_include.jl`ä¸­ï¼š
â†“æ–‡ä»¶æœ«å°¾æœ‰æ¢è¡Œç¬¦

```julia
# è¿™æ˜¯ä¸€ä¸ªè¦è¢«å¼•å…¥çš„å¤–éƒ¨å­—å…¸å¯¹è±¡
Dict([
  1 => 1
  2 => 4
  3 => 9
  # ...
])
```

ç¼–è¯‘åï¼š

```julia
const square_map_dict = # è¿™é‡Œçš„ç­‰å·å¯ä»¥å¦èµ·ä¸€è¡Œ
# è¿™æ˜¯ä¸€ä¸ªè¦è¢«å¼•å…¥çš„å¤–éƒ¨å­—å…¸å¯¹è±¡
Dict([
  1 => 1
  2 => 4
  3 => 9
  # ...
])
# â†‘ ä¸Šé¢ä¸€è¡Œä¼šè¢«æ›¿æ¢æˆæ•°æ®
```

ğŸ“Juliaçš„ã€Œç©ºç™½ç¬¦æ— å…³æ€§ã€å…è®¸åœ¨ç­‰å·åè¾¹å¤§èŒƒå›´é™„å¸¦æ³¨é‡Šçš„ç©ºç™½

##### æ–‡ä»¶å†…è”

ä¸»è¦ç”¨é€”ï¼šä¸ºã€Œæ–‡ä»¶å¼•å…¥ã€æä¾›ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œå¹¶**æ”¯æŒã€Œç¼–è¯‘åå†…è”ç¬”è®°æœ¬ã€**

- å¦‚ï¼šç¼–è¯‘å¹¶é›†æˆ**å…¶å®ƒç¬”è®°æœ¬**åˆ°è¯¥æ–‡ä»¶ä¸­

ç¼–è¯‘å‰@ç¬”è®°æœ¬å•å…ƒæ ¼ï¼š

```julia
const square_map_dict = # è¿™é‡Œçš„ç­‰å·å¯ä»¥å¦èµ·ä¸€è¡Œ
#= %inline-compiled =# include("to_include.jl")
# â†‘ ä¸Šé¢ä¸€è¡Œä¼šè¢«æ›¿æ¢æˆæ–‡ä»¶å†…å®¹
# * è‹¥ä¸ºä½¿ç”¨`include_notebook`å¼•å…¥çš„ç¬”è®°æœ¬ï¼Œåˆ™ä¼šè¢«æ›¿æ¢ä¸ºç¼–è¯‘åçš„ç¬”è®°æœ¬å†…å®¹
```

ç¼–è¯‘å‰@å’Œç¬”è®°æœ¬**åŒç›®å½•**ä¸‹çš„`to_include.jl`ä¸­ï¼š
â†“æ–‡ä»¶æœ«å°¾æœ‰æ¢è¡Œç¬¦

```julia
# è¿™æ˜¯ä¸€ä¸ªè¦è¢«å¼•å…¥çš„å¤–éƒ¨å­—å…¸å¯¹è±¡
Dict([
  1 => 1
  2 => 4
  3 => 9
  # ...
])
```

ç¼–è¯‘åï¼š

```julia
const square_map_dict = # è¿™é‡Œçš„ç­‰å·å¯ä»¥å¦èµ·ä¸€è¡Œ
# è¿™æ˜¯ä¸€ä¸ªè¦è¢«å¼•å…¥çš„å¤–éƒ¨å­—å…¸å¯¹è±¡
Dict([
  1 => 1
  2 => 4
  3 => 9
  # ...
])
# â†‘ ä¸Šé¢ä¸€è¡Œä¼šè¢«æ›¿æ¢æˆæ•°æ®
```

ğŸ“Juliaçš„ã€Œç©ºç™½ç¬¦æ— å…³æ€§ã€å…è®¸åœ¨ç­‰å·åè¾¹å¤§èŒƒå›´é™„å¸¦æ³¨é‡Šçš„ç©ºç™½

## å‚è€ƒ

- æœ¬Juliaåº“çš„çµæ„Ÿæ¥æºï¼š[Promises.jl/src/notebook.jl](https://github.com/fonsp/Promises.jl/blob/main/src/notebook.jl)
  - æºåº“ä½¿ç”¨äº† [**Pluto.jl**](https://github.com/fonsp/Pluto.jl) çš„ã€Œç¬”è®°æœ¬å¯¼å‡ºã€åŠŸèƒ½
- **Jupyter Notebook** æ–‡ä»¶æ ¼å¼ï¼ˆJSONï¼‰ï¼š[ğŸ”—nbformat.readthedocs.io](https://nbformat.readthedocs.io/en/latest/format_description.html#notebook-file-format)
